---
title: "Pre-emptive or reactive in-dwelling catheterisation does not impact patient-reported urinary symptoms following lower limb arthroplasty: A prospective cohort study in a metropolitan public hospital."
author: "Corey Scholes"
date: "2023-Nov-09"
date-modified: "2025-Feb-25"
type: website
editor: visual
execute: 
  echo: false
  warning: false
  message: false
format:
  html:
    toc: true
    number-sections: true
    code-fold: true
bibliography: references.bib
---

## Preamble

**Author Affiliation:** EBM Analytics

**Client \| Sponsor:** Lorenzo Calabro, QEII Orthopaedics Department, Metro South

**EBMAReference**: Pub_Catheterisation_CB030Jun20

**Version:** 1.0

<!--# Check sharing settings of manuscript when attaching as supplementary file -->

This analysis is a companion piece to the [manuscript](https://docs.google.com/document/d/1clQD9FLJddAxSkf4m3Ox4_skqEmkz8ieoxdEDVjXvPo/edit?usp=sharing "Link to RAS manuscript draft") of the project. The analysis report has been organised as per the STROBE guidelines and checklist [@Vandenbroucke2007]. The contents of the sections has been derived from the manuscript (partly completed at the time of drafting), the [protocol](https://drive.google.com/file/d/15XY0UEf0YYIWuJhtPWUDXbBLfwnKZAOr/view?usp=sharing "Early RAS HREC protocol - approved") approved by the local health district HREC 13-Jun-2023, as well as an earlier [study viability report](https://docs.google.com/presentation/d/1cj4_lGa0OhAg25rQvJh1M1d_UirlHdb6Y9L7pL1IaSc/edit?usp=sharing "Early RAS study viability report") generated by EBMA, and the results of the analysis, where appropriate.The analysis was generated using R [@base] `R.Version()$version.string` in RStudio (v2024.12.1+563) and Quarto (v1.4.549) with appropriate specialised packages as required. Code and text were combined within the report using the *epoxy* package (v`{r} utils::packageVersion("epoxy")`)) [@epoxy].

## Reporting

The study was reported according to the STROBE guidelines [@Vandenbroucke2007] and companion checklist.

The analysis was conducted in RStudio IDE (RStudio 2024.12.0+467 "Kousa Dogwood" Release) using *Rbase* [@base], *quarto* [@quarto] and attached packages to perform the following;

-   Data import and preparation

-   Sample selection

-   Describe and address missingness

-   Data manipulation, modelling and visualisation of;

    -   Patient characteristics

    -   Treatment characteristics

    -   Adverse events and complications

    -   Patient reported outcomes

-   Publish to posit connect for dissemination

## STROBE \[1\] Title:

<!--# Assess the appropriateness and appeal of the title -->

The title has been expressed in a declarative statement regarding the main findings.

Draft title: Pre-emptive or reactive in-dwelling catheterisation does not impact patient-reported urinary symptoms following lower limb arthroplasty: A prospective cohort study in a metropolitan public hospital.

## STROBE \[1\] Abstract:

<!--# Critically analyse the informative and balanced nature of the abstract. -->

# Analysis Introduction:

<!--# Critically assess the justification for conducting the observational study. -->

The rationale for the study and justification can be found in the viability reports conducted prior to initiation.

Question check -

Viability report -

Study plan -

## Analysis Preparation

Load up required packages in advance; check if packages are installed, if not, install them. Citations applied to each library at first use in the text.

```{r Load packages}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
  "gargle",
  "cardx",
  "lme4",
  "ggalluvial",
  "tidyverse",
  "consort",
  "reshape",
  "future",
  "furrr",
  "memoise",
  "googlesheets4",
  "openxlsx2",
  "readr",
  "purrr",
  "tidyverse",
  "tidymodels",
  "tidytext",
  "stopwords",
  "tictoc",
  "lubridate",
  "forcats",
  "gt",
  "consort",
  "gtsummary",
  "flextable",
  "survival",
  "ggplot2",
  "ggdist",
  "ggsurvfit",
  "ggfortify",
  "mice",
  "marginaleffects",
  "patchwork",
  "naniar",
  "quantreg",
  "broom",
  "broom.helpers",
  "labelled",
  "epoxy",
  "broom.mixed",
  "lme4",
  "janitor",
  "progressr",
  "DT",
  install = TRUE,
  update = FALSE
)

```

## Authorisations

Pre-authorise access to registry datasets using the *gargle* package (v`{r} utils::packageVersion("gargle")`) [@gargle].

```{r, echo = FALSE}

# Set the cache location
options(gargle_oauth_cache = ".secrets")

# Use the saved token for non-interactive auth
googledrive::drive_auth(email = "cscholes@ebma.com.au", 
          cache = ".secrets")
```

```{r, echo = FALSE}

options(
  gargle_oauth_cache = ".secrets",
  gargle_oauth_email = TRUE
)

googledrive::drive_auth(cache = ".secrets", email = TRUE)
googlesheets4::gs4_auth(cache = ".secrets", email = TRUE)
```

## Functions

Include a series of functions to call later in the file for processing data imports.



## STROBE \[2\] Background

<!--# Provide a critical analysis of the background information on the research question or problem. -->

The introduction is not yet fully drafted.

## STROBE \[3\] Objectives

<!--# Evaluate the clarity and significance of the study's objectives and hypotheses. -->

We sought to characterise the rate of patient reported urinary complications, and patient satisfaction with urinary management following elective hip and knee arthroplasty. Our secondary aim was to identify the patient and surgical factors predicting the incidence and severity of urinary complications following lower limb arthroplasty.

The study objectives have evolved over time. The original study question as per the study plan was the following;

+--------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Component    | Study-Specific                                                                                                                           |
+==============+==========================================================================================================================================+
| Population   | In patients electing to undergo hip or knee total arthroplasty with one of four participating surgeons in a metropolitan public hospital |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Intervention | How do those that report a change in urinary symptoms between pre-admission clinic and 21 days after surgery differ to                   |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Comparator   | Those that do not report a change in symptoms                                                                                            |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Outcomes     | Primary: In patient characteristics, baseline symptoms and management factors                                                            |
|              |                                                                                                                                          |
|              | Secondary: In satisfaction with urinary management/incidence of POUR at 2-week follow-up                                                 |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Study Design | Within an observational cohort design embedded into the SHARKS registry (QEII Orthopaedic Department)                                    |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------+

: Table 1a: Study *Question 1* as per study plan.

+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Component    | Study-Specific                                                                                                                                                                     |
+==============+====================================================================================================================================================================================+
| Population   | In patients electing to undergo hip or knee total arthroplasty with one of four participating surgeons in a metropolitan public hospital                                           |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Intervention | Receiving pre-emptive urinary catheterisation                                                                                                                                      |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Comparator   | Compared to those that do not                                                                                                                                                      |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Outcomes     | How do i) urinary symptoms as measured by the core lower urinary tract symptom score (CLSS) and ii) satisfaction with urinary management in-hospital at two weeks followup differ? |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Study Design | Within an observational cohort design embedded into the SHARKS registry (QEII Orthopaedic Department)                                                                              |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

: Table 1b: Study *Question 2*

### Hypotheses

+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Question  | Clinical                                                                                                                                                                       | Statistical                                                                                                                                                   |
+===========+================================================================================================================================================================================+===============================================================================================================================================================+
| 1         | 1.  Patients reporting an increase or appearance of lower urinary tract symptoms will possess a combination of risk factors, including                                         | H1: The predicted probability of a change in urinary symptoms by a multivariable model will be closer to actual probabilities than expected by chance         |
|           |                                                                                                                                                                                |                                                                                                                                                               |
|           |     1.  Symptoms prior to surgery                                                                                                                                              | H0: The predicted probability of a change in urinary symptoms by a multivariable model will **not be** closer to actual probabilities than expected by chance |
|           |                                                                                                                                                                                |                                                                                                                                                               |
|           |     2.  Catheterisation (planned vs unplanned)                                                                                                                                 |                                                                                                                                                               |
|           |                                                                                                                                                                                |                                                                                                                                                               |
|           |     3.  Comorbidities                                                                                                                                                          |                                                                                                                                                               |
|           |                                                                                                                                                                                |                                                                                                                                                               |
|           |     4.  Older age                                                                                                                                                              |                                                                                                                                                               |
|           |                                                                                                                                                                                |                                                                                                                                                               |
|           |     5.  Male gender                                                                                                                                                            |                                                                                                                                                               |
+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 1         | Patients with symptoms will tend to be less satisfied with the management received for managing POUR                                                                           |                                                                                                                                                               |
+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 2         | Patients receiving reactive catheterisation on the recovery ward in response to image-detected urinary retention will report worse CLSS and satisfaction at two week follow up | H1: The predicted probability of a postoperative urinary symptoms by a multivariable model will be closer to actual probabilities than expected by chance     |
|           |                                                                                                                                                                                |                                                                                                                                                               |
|           |                                                                                                                                                                                | H0: The predicted probability of a change in urinary symptoms by a multivariable model will **not be** closer to actual probabilities than expected by chance |
+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+

: Table 2: Study hypotheses for present analysis

# Methods:

## STROBE \[4\] Study Design:

<!--# Critically evaluate the appropriateness of the chosen observational study design (e.g., cohort, case-control). -->

Observational cohort study embedded into a department clinical quality registry for lower limb arthroplasty (SHARKS).

## STROBE \[5\] Setting:

<!--# Assess the relevance and representativeness of the study setting. -->

The study setting is an orthopaedic department within a medium-sized metropolitan public hospital in a capital city of Australia. The analysis and data collection were sampled from all eligible arthroplasty cases from the commencement date of the study to the time of initial analysis. It is asserted that the setting is representative of orthopaedic care in Australia and possesses sufficient equivalence for consideration internationally.

## STROBE \[6\] Participants:

*Critique the definition of the study population, including inclusion and exclusion criteria.*

## STROBE \[7\] Variables:

<!--# Evaluate the choice of exposure, outcome, and confounding variables. -->

A [core dataset](https://docs.google.com/spreadsheets/d/1x3LChn3Zh7qPkVQ4rRM0MyjdpfpR-myoZp7oAkq_fKc/edit?usp=sharing "Study core dataset") for the study was derived a-priori.

### Outcome(s)

The study outcomes were centred on the core lower urinary tract symptom score (CLSS).

## STROBE \[8\] Data Sources/Measurement:

### Data Import and Preparation

Retrieve and format data from live tables and registry snapshot. Using *openxlsx* (`{r} version(pkg = "openxlsx2")`) [@openxlsx2] to retrieve static snapshot files and *googlesheets4* (`{r} version(pkg = "googlesheets4")`) [@googlesheets4] to retrieve live database tables.

```{r}

SheetID = "https://docs.google.com/spreadsheets/d/1Q7u3-5Q7q94pI2Vq4FAOHNya0upf4vcbK3A5b2twXtU/edit"

```


```{r Registry Table Import}

# Authenticate for sheets using the same token
gs4_auth(token = drive_token())

Master <- googlesheets4::range_read(
  ss = SheetID,
  sheet = "Mastersheet",
  range = "A3:AW",
  col_names = TRUE,
  col_types = "TccccDcccnncccccccncDDcnccttnccTTcTTTnnnccnnccicc",
  trim_ws = TRUE
)

MasterFilter <- googlesheets4::range_read(
  ss = "https://docs.google.com/spreadsheets/d/1Q7u3-5Q7q94pI2Vq4FAOHNya0upf4vcbK3A5b2twXtU/edit",
  sheet = "MasterFilter",
  range = "A1:BU",
  col_names = TRUE,
  col_types = "TccccDcccnncccccccncTDcnccttnccTTcTTTnnnccnncccccccccccccccccccccccciiccn",
  trim_ws = TRUE
)

```


```{r}

STROBEFlow <- Master |> dplyr::filter(
  !is.na(URN) & stringr::str_detect(Consent,"Test", negate = TRUE)
) |> dplyr::select(
  URN,
  Consent,
  Status1,
  Status2,
  `Baseline CLSS - Total Score`,
  `Postoperative CLSS - Total score`,
  `Date of surgery`,
  `Operated Joint`
) |> dplyr::mutate(
    exclusion1 = dplyr::if_else( #exclusion before induction
    stringr::str_detect(Consent,"Completed"), NA_character_, stringr::str_split_i(Status1,"; ", 2)
    ),
  exclusion2 = case_when( #exclusion after induction
    Consent == "Completed" & is.na(Status1) ~ NA_character_,
    Consent == "Completed" & !is.na(Status1) ~ stringr::str_split_i(Status1,"; ", 2),
    Consent != "Completed" ~ NA_character_
  ),
  induction = dplyr::if_else(Status2 == "Complete",URN,NA_character_), #chart review completed
  followup = case_when( #expectation of CLSS follow up
    !is.na(induction) & !is.na(exclusion2) ~ NA_character_,
    is.na(induction) ~ NA_character_,
    .default = URN
),
 assessed = case_when(
   !is.na(induction) & !is.na(followup) & !is.na( `Postoperative CLSS - Total score`) ~ URN,
   .default = NA_character_
 ),
lost_followup = if_else(!is.na(followup) & is.na(assessed),"Lost to followup",NA_character_),
CombID = if_else(!is.na(followup), 
  stringr::str_c(
    URN,
    as.numeric(`Date of surgery`),
    `Operated Joint`
  ), NA_character_
)
)|> dplyr::rename(
  trialno = "URN"
)

```

*Prepare analysis dataset*

```{r}

STROBEFlow2 <- STROBEFlow |> dplyr::filter(
  !is.na(CombID) & Consent == "Completed"
)

MasterFilter2 <- MasterFilter |> dplyr::mutate(
  CombID = stringr::str_c(
    URN,
    as.numeric(`Date of surgery`),
    `Operated Joint`
  ),
  Surgeon = case_when(
    Surgeon == "McLean" ~ "McLean Andrew",
    Surgeon == "Calabro Lorzenzo" ~ "Calabro Lorenzo",
    .default =  stringr::str_to_title(stringr::str_squish(Surgeon))
  ),
  Surgeon1 = case_when(
    Surgeon == "Calabro Lorenzo" ~ "A",
    Surgeon == "Fitzpatrick Prudence" ~ "B",
    Surgeon == "Bell Christopher" ~ "C",
    Surgeon == "Balendra Ganesh" ~ "D",
    Surgeon == "Meta Mahendra" ~ "E",
    Surgeon == "McLean Andrew" ~ "F"
  ),
  Surgeon2 = forcats::fct(Surgeon1,
                          levels = c(
                            "A","B","C","D","E","F"
                          )),
  UrineMCS = stringr::str_to_title(`Urine MCS result`),
  AnalgesicStrategy2 = dplyr::if_else(
    `Analgesic strategy` == "Fentanyl/Bupivicaine", "Yes","No"
  ),
  AnaesthesiaType2 = dplyr::if_else(
    stringr::str_detect(`Anaesthesia type`, "Spinal"), "Yes", "No"
  ),
  SurgicalDuration = `Surgical time (mins)` * 24 * 60
  ) |>  dplyr::filter(
  CombID %in% STROBEFlow2$CombID
) |> dplyr::rename(
  AgeAtSurgery = "Age at surgery",
  Joint = "Operated Joint",
  Sex = "Gender"
)
  
```

*Convert PROMS to long dataset*

```{r}
MasterPROM1 <- MasterFilter |> dplyr::mutate(
  CombID = stringr::str_c(
    URN,
    as.numeric(`Date of surgery`),
    `Operated Joint`
  )
) |> dplyr::select(
  CombID,
  contains ("CLSS")
) |> dplyr::rename(
  CLSSTotal_Pre = "Baseline CLSS - Total Score",
  CLSSTotal_Post = "Postoperative CLSS - Total score",
  CLSSSat_Pre = "Baseline CLSS - Satisfaction",
  CLSSSat_Post = "Postoperative CLSS - Satisfaction",
) |> mutate(
  CLSSSat_Pre = dplyr::if_else(stringr::str_detect(CLSSSat_Pre,"Mixed"),"Mixed",CLSSSat_Pre),
  CLSSSat_Post = dplyr::if_else(stringr::str_detect(CLSSSat_Post,"Mixed"),"Mixed",CLSSSat_Post),
  CLSSQ11_Pre = dplyr::if_else(stringr::str_detect(CLSSQ11_Pre,"Mixed"),"Mixed",CLSSQ11_Pre),
  CLSSQ11_Post = dplyr::if_else(stringr::str_detect(CLSSQ11_Post,"Mixed"),"Mixed",CLSSQ11_Post)
) |> dplyr::mutate(
  across(c(CLSSQ1_Pre,CLSSQ1_Post),~forcats::fct_relevel(., "~7", "8~9", "10~14", "15~")),
  across(c(CLSSQ2_Pre,CLSSQ2_Post),~forcats::fct_relevel(., "0", "1", "2~3", "4~")),
  across(c(CLSSQ3_Pre:CLSSQ10_Pre,CLSSQ3_Post:CLSSQ10_Post),~forcats::fct_relevel(., "No", "Rarely", "Sometimes", "Often"))
)
```

```{r}



# First handle the Total scores (numeric)
CLSSTotal <- tidyr::pivot_longer(
    data = MasterPROM1 |> dplyr::select(
      CombID,
      starts_with("CLSSTotal")
    ),
    cols = starts_with("CLSSTotal"),
    names_pattern = "CLSSTotal_(Pre|Post)",
    names_to = "Timepoint",
    values_to = "Total"
  ) |> dplyr::mutate(
    Timepoint = forcats::fct(Timepoint, levels = c("Pre", "Post"))
  )

# Then handle the question responses (character)
CLSSQuestion <- tidyr::pivot_longer(
  data = MasterPROM1 |> dplyr::select(
    CombID,
    starts_with(c(
      "CLSSSat",
      "CLSSQ"
      )
    )
),
    cols = starts_with("CLSS"),
    names_pattern = "CLSS(Sat|Q\\d+)_(Pre|Post)",
    names_to = c("Question", "Timepoint"),
    values_to = "Score"
  ) |> dplyr::mutate(
    Timepoint = forcats::fct(Timepoint, levels = c("Pre", "Post"))
  )


```

*Establish model input dataset*

```{r}
CLSSTotal2 <- dplyr::left_join(
  CLSSTotal,
  MasterFilter2 |> dplyr::select(
    CombID,
    AgeAtSurgery,
    Sex,
    Bilateral,
    Joint,
    `Pre-emptive IDC`
  ),
  by = "CombID"
) |> dplyr::filter(
    !is.na(Total)
)
```

## STROBE \[9\] Bias:

<!--# Critically analyze potential sources of bias and the adequacy of methods used to address them. -->

## Missing Data

## STROBE \[10\] Study size:

<!--# *Critically analyze the final study sample and the rationale/methods used for its justification.* -->

## STROBE \[11\] Quantitative variables:

<!--# *Evaluate the analytical choices of the quantitative variables within the dataset.* -->

## STROBE \[12\] Statistical Methods:

<!--# *Evaluate the appropriateness and robustness of the statistical techniques used for analysis.* -->

# Results:

## STROBE \[13\] Participant Flow:

<!--# *Critically assess the transparency and completeness of participant flow reporting.* -->

```{r}
STROBEplot <- consort_plot(
  data = STROBEFlow,
  orders = c(
    trialno = "Population",
    exclusion1 = "Screened Out",
    trialno = "Recruited",
    induction = "Chart review",
    exclusion2 = "Excluded",
    followup = "Eligible for CLSS",
    lost_followup = "Not evaluated",
    assessed = "Followup CLSS returned"
  ),
  side_box = c(
    "exclusion1",
    "exclusion2",
    "lost_followup"
  ),
  cex = 0.8
)

knitr::knit_print(STROBEplot)

```

## STROBE \[14\] Descriptive Data:

<!--# *Evaluate the adequacy of the presentation of characteristics of the study population.* -->

```{r}

TableSummary1 <- gtsummary::tbl_summary(
  data = MasterFilter2,
  include = c(
    "AgeAtSurgery",
    "BMI",
    "Sex",
    "Bilateral",
    "Joint",
    "Surgeon2",
    "Comorbidities - diabetes",
    "Comorbidities - cardiovascular",
    "Comorbidities - neurological",
    "Comorbidities - previous urologic surgery",
    "UrineMCS"
  ),
  label = list(
    AgeAtSurgery = "Age at surgery",
    Surgeon2 = "Surgeon"
  ),
  type = list(
    Bilateral ~ "dichotomous"
    ),
  value = list(
    Bilateral = "Bilateral"
  ),
  statistic = list(
    all_continuous() ~ "{mean} ({sd})",
    all_categorical() ~ "{p}% ({n})"
    ),
  digits = list(
    all_continuous() ~ 1,
    all_categorical() ~ c(1,0)
  )
)

knitr::knit_print(TableSummary1)

```

```{r}

TableSummary2 <- gtsummary::tbl_summary(
  data = MasterFilter2,
  include = c(
    "AgeAtSurgery",
    "BMI",
    "Sex",
    "Bilateral",
    "Joint",
    "Surgeon2",
    "Comorbidities - diabetes",
    "Comorbidities - cardiovascular",
    "Comorbidities - neurological",
    "Comorbidities - previous urologic surgery",
    "UrineMCS",
    "AnalgesicStrategy2",
    "Intraop fluid (mL)",
    "AnaesthesiaType2",
    "SurgicalDuration",
    "Routine IDC insertion",
    "Reactive IDC insertion"
  ),
  by = `Routine IDC insertion`,
  label = list(
    AgeAtSurgery = "Age at surgery",
    Surgeon2 = "Surgeon",
    AnalgesicStrategy2 = "Fentanyl - Bupivicaine",
    AnaesthesiaType2 = "Spinal anaesthesia"
  ),
  type = list(
    Bilateral ~ "dichotomous",
    Sex ~ "dichotomous",
    UrineMCS ~ "dichotomous"
    ),
  value = list(
    Bilateral = "Bilateral",
    Sex = "Female",
    UrineMCS = "Bacteriuria"
  ),
  statistic = list(
    all_continuous() ~ "{mean} ({sd})",
    all_categorical() ~ "{p}% ({n})"
    ),
  digits = list(
    all_continuous() ~ 1,
    all_categorical() ~ c(1,0)
  )
) |> add_overall() |> add_ci(
  statistic = list(
    all_continuous() ~ "{conf.low} - {conf.high}",
    all_categorical() ~ "{conf.low} - {conf.high}"),
) |> add_p() |> add_q()

knitr::knit_print(TableSummary2)

```

```{epoxy}



```

## STROBE \[15\] Outcome Data:

<!--# *Evaluate the adequacy of the presentation of outcome data (over time).* -->

<!--# *Need to adjust the summary stat labels on x axis* -->

```{r}
CLSSTotal1 <- ggplot(data = CLSSTotal, mapping = aes(y = Total, x = Timepoint)) +
  stat_halfeye(aes(thickness = after_stat(pdf*n)), scale = 0.7) +
  stat_summary(fun.data = function(x) {
    data.frame(
      y = mean(x), # Position at the mean
      label = sprintf("%.1f Â± %.1f", mean(x), sd(x))
    )
  }, geom = "text" 
  ) +  scale_fill_brewer(palette = "Set2") +
  ggtitle('Core Lower Urinary Tract Symptom Score') + 
  ylab("Total Score") + 
  ggpubr::stat_compare_means(
    label.y = 12,
    label.x = 1.5
  )

knitr::knit_print(CLSSTotal1)
```

Figure 2: Summary of CLSS total score before and after lower limb arthroplasty

```{r}

CLSSPlot1Dat <- CLSSQuestion |> dplyr::filter(
  Question == "Q1" & !is.na(Score)
) |> dplyr::summarise(
  count = n(),
  .by = c(Score,Timepoint)
) |> dplyr::group_by(
  Timepoint
  ) |> dplyr::mutate(
  Percentage = (count / sum(count)) * 100,
  Response = forcats::fct(Score, levels = c("~7", "8~9", "10~14", "15~")),
) |> dplyr::ungroup()

CLSSPlot2Dat <- CLSSQuestion |> dplyr::filter(
  Question == "Q2" & !is.na(Score)
) |> dplyr::summarise(
  count = n(),
  .by = c(Score,Timepoint)
) |> dplyr::group_by(
  Timepoint
  ) |> dplyr::mutate(
  Percentage = (count / sum(count)) * 100,
  Response = forcats::fct(Score, levels = c("0", "1", "2~3", "4~")),
) |> dplyr::ungroup()

# CLSSPlot310Dat <- CLSSQuestion |> dplyr::filter(
#   stringr::str_detect(Question,"3|4|5|6|7|8|9|10") & !is.na(Score)
# ) |> dplyr::group_by(
#     Question
#   ) 

# |> dplyr::summarise(
#   count = n(),
#   .by = c(Score,Timepoint)
# ) |> dplyr::group_by(
#   Timepoint
#   ) |> dplyr::mutate(
#   Percentage = (count / sum(count)) * 100,
#   Response = forcats::fct(Score, levels = c("0", "1", "2~3", "4~")),
# ) |> dplyr::ungroup()

CLSSPlot1 <- ggplot(CLSSPlot1Dat, aes(fill=Response, y=Percentage, x=Timepoint)) +
    geom_bar(position="stack", stat="identity") +
    scale_y_continuous(labels = function(x) paste0(x, "%")) +
    labs(y = "Percentage") +
    ggtitle("Daily Frequency")

CLSSPlot2 <- ggplot(CLSSPlot2Dat, aes(fill=Response, y=Percentage, x=Timepoint)) +
    geom_bar(position="stack", stat="identity") +
    scale_y_continuous(labels = function(x) paste0(x, "%")) +
    labs(y = "Percentage") +
    ggtitle("Nightly Frequency")

CLSSPlot1 + CLSSPlot2

```

*Do the responses remain stable at the individual level*

```{r}

plot_individual_transitions <- function(data, question, custom_title = NULL) {
  # Prepare data for alluvial plot
  transitions_data <- data %>%
    dplyr::filter(Question == question & !is.na(Response)) %>%
    dplyr::select(CombID, Timepoint, Response) %>%
    dplyr::mutate(
      Timepoint = factor(Timepoint, levels = c("Pre", "Post")),
      #Score = factor(Score, levels = unique(Response))  # Preserve order
    )
  
  # Set title - use custom title if provided, otherwise use default
  plot_title <- if (!is.null(custom_title)) {
    stringr::str_c("Individual Patient Transitions -", question, custom_title, sep = " ")
  } else {
    paste("Individual Patient Transitions -", question)
  }
  
  # Create alluvial plot
  ggplot(transitions_data,
         aes(x = Timepoint, stratum = Response, alluvium = CombID, 
             fill = Response, label = Response)) +
        geom_flow(alpha = 0.5) +
    geom_stratum(alpha = 0.8) +
    geom_text(stat = "stratum", size = 3) +
    theme_minimal() +
    theme(
      legend.position = "none",
      panel.grid.major.x = element_blank(),
      panel.grid.minor = element_blank(),
      axis.text.y = element_blank()
    ) +
    labs(
      title = plot_title,
      subtitle = paste("n =", length(unique(transitions_data$CombID))),
      x = "Timepoint",
      y = "Number of Patients"
    ) +
    scale_x_discrete(expand = c(0.1, 0.1))
}

```

```{r}

CLSSTransQ1 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q1"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("~7", "8~9", "10~14", "15~"))
  ), 
  "Q1",
  "Daily Frequency")

knitr::knit_print(CLSSTransQ1)
```

```{r}
CLSSTransQ2 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q2"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("0", "1", "2~3", "4~"))
  ), 
  "Q2",
  "Nightly Frequency"
  )

knitr::knit_print(CLSSTransQ2)
```

```{r}
CLSSTransQ3 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q3"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q3",
  "Urination Desire"
  )

knitr::knit_print(CLSSTransQ3)
```

```{r}
CLSSTransQ4 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q4"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q4",
  "Leakage"
  )

knitr::knit_print(CLSSTransQ4)
```

```{r}
CLSSTransQ5 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q5"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q5",
  "Leakage - Cough/Sneeze"
  )

knitr::knit_print(CLSSTransQ5)
```

```{r}
CLSSTransQ6 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q6"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q6",
  "Slow Stream"
  )

knitr::knit_print(CLSSTransQ6)
```

```{r}
CLSSTransQ7 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q7"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q7",
  "Need to strain"
  )

knitr::knit_print(CLSSTransQ7)
```

```{r}
CLSSTransQ8 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q8"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q8",
  "Feeling incomplete emptying"
  )

knitr::knit_print(CLSSTransQ8)
```

```{r}
CLSSTransQ9 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q9"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q9",
  "Pain Bladder"
  )

knitr::knit_print(CLSSTransQ9)
```

```{r}
CLSSTransQ10 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q10"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q10",
  "Pain Urethra"
  )

knitr::knit_print(CLSSTransQ10)
```

```{r}
CLSSTransSat <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Sat"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("Terrible", "Unhappy", "Mostly dissatisfied", "Mixed","Mostly satisfied", "Pleased", "Delighted"))
  ), 
  "Sat",
  "Symptom Satisfaction"
  )

knitr::knit_print(CLSSTransSat)
```

## STROBE \[16\] Main Results:

*Critically analyze the presentation and interpretation of primary findings, including effect estimates and confidence intervals.*

```{r}

CLSSTotal2a <- CLSSTotal2 |> group_by(
  CombID
) |> count() |> dplyr::filter(
  n == 2
) |> ungroup()

CLSSTotal3 <- CLSSTotal2 |> dplyr::filter(
    CombID %in% CLSSTotal2a$CombID
) |> mutate(
  Timepoint1 = if_else(
    Timepoint == "Pre", 0,1
  ),
  PreIDC = if_else(
    `Pre-emptive IDC` == "No", 0,1
  )
)

```

```{r}

CLSSMod1 <- lme4::lmer(
  Total ~ Sex + AgeAtSurgery + Timepoint + (1|CombID),
  data = CLSSTotal3
  )
  
  CLSSMod2 <- lme4::lmer(
  Total ~ Timepoint1 + Sex + AgeAtSurgery + (Timepoint1||CombID),
  data = CLSSTotal3 |> dplyr::filter(
    PreIDC == 1
  )
  )

```

```{r}
confint(CLSSMod2)
```

```{r}
summary(CLSSMod2)
```

```{r}

CLSSModTable <- gtsummary::tbl_regression(
  CLSSMod2,
  exponentiate = TRUE,
  pvalue_fun = label_style_pvalue(digits = 2),
  tidy_fun = broom.mixed::tidy,
  show_single_row = c(
    "Timepoint1",
    "Sex"
  )
) |> add_global_p()

knitr::knit_print(CLSSModTable)


```

## STROBE \[17\] Other Analyses:

*Critically analyze the presentation and interpretation of subgroups, interactions or the description and evaluation of sensitivity analyses.*

# Discussion:

## STROBE \[18\] Key Results:

*Critically interpret the findings in the context of the study objectives.*

## STROBE \[19\] Limitations:

*Provide a thorough critique of the limitations of the study design, methods, and data.*

## STROBE \[20\] Interpretation:

*Assess whether the interpretation is adequately cautious and whether the comparisons to related literature are appropriate. Assess the implications of the findings for clinical practice and the need for further research, considering alternative interpretations.*

## STROBE \[21\] Generalizability:

*Evaluate the strength of evidence supporting the external validity of the findings.*

## Comparison with Existing Literature:

*Critically compare findings with previous research, assessing consistency and discrepancies.*

# Ethical Considerations:

## Informed Consent:

*Critically analyze the adequacy of procedures for obtaining informed consent from participants.*

## Ethical Approval:

*Evaluate whether the study received appropriate approval from an ethics committee or institutional review board.*

## Privacy and Confidentiality:

*Assess the adequacy of measures taken to protect participants' privacy and confidentiality. Beneficence and Non-maleficence: Critically evaluate any potential risks or benefits to participants and how they were addressed.*

# Conflicts of Interest:

## STROBE \[22\] Funding:

*Assess the degree of transparency to which the source of funding and role of the funders have played in the study/article.*

## Disclosure:

*Evaluate the transparency and completeness of disclosures regarding conflicts of interest among the study authors or sponsors.*

## Potential for Biases:

*Critically assess whether conflicts of interest could have influenced the study design, analysis, or interpretation of results.*

# References
