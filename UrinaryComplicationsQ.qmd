---
title: "Pre-emptive or reactive in-dwelling catheterisation does not impact patient-reported urinary symptoms following lower limb arthroplasty: A prospective cohort study in a metropolitan public hospital."
author: "Corey Scholes"
date: "2023-Nov-09"
date-modified: "2025-Feb-25"
type: website
editor: visual
execute: 
  echo: false
  warning: false
  message: false
format:
  html:
    toc: true
    number-sections: true
    code-fold: true
bibliography: references.bib
---

## Preamble

**Author Affiliation:** EBM Analytics

**Client \| Sponsor:** Lorenzo Calabro, QEII Orthopaedics Department, Metro South

**EBMAReference**: Pub_Catheterisation_CB030Jun20

**Version:** 1.0

<!--# Check sharing settings of manuscript when attaching as supplementary file -->

This analysis is a companion piece to the [manuscript](https://docs.google.com/document/d/1clQD9FLJddAxSkf4m3Ox4_skqEmkz8ieoxdEDVjXvPo/edit?usp=sharing "Link to RAS manuscript draft") of the project. The analysis report has been organised as per the STROBE guidelines and checklist [@Vandenbroucke2007]. The contents of the sections has been derived from the manuscript (partly completed at the time of drafting), the [protocol](https://drive.google.com/file/d/11nJk9FzYCnnvkSFyO_7dKt1W2sqc85N4/view?usp=sharing) approved by the local health district HREC 13-Jun-2023, as well as an earlier study viability report generated by EBMA, and the results of the analysis, where appropriate.

## Reporting

The study was reported according to the STROBE guidelines [@Vandenbroucke2007] and companion checklist.

The analysis was generated using R [@base] `R.Version()$version.string` in RStudio (v2024.12.1+563) and Quarto (v1.4.549) with appropriate specialised packages as required. Citations are applied to each library at first use in the text. Code and text were combined within the report using the *epoxy* package (v`{r} utils::packageVersion("epoxy")`) [@epoxy]. The following actions were performed;

-   Data import and preparation

-   Sample selection

-   Describe and address missingness

-   Data manipulation, modelling and visualisation of;

    -   Patient characteristics

    -   Treatment characteristics

    -   Adverse events and complications

    -   Patient reported outcomes

-   Publish to web for dissemination

## STROBE \[1\] Title:

<!--# Assess the appropriateness and appeal of the title -->

The title has been expressed in a declarative statement regarding the main findings and suggested as the following;

*Pre-emptive or reactive in-dwelling catheterisation does not meaningfully impact patient-reported urinary symptoms following lower limb arthroplasty: A prospective cohort study in a metropolitan public hospital.*

## STROBE \[1\] Abstract:

<!--# Critically analyse the informative and balanced nature of the abstract. -->

To be finalised as part of manuscrupt.

# Analysis Introduction:

<!--# Critically assess the justification for conducting the observational study. -->

The rationale for the study and justification can be found in the viability reports conducted prior to project initiation.

[Question check](https://drive.google.com/file/d/1vIp_AYjzyQMkcG_Rrls5xwsWbneqa_Um/view?usp=sharing)

[Study plan](https://drive.google.com/file/d/1mLIpGySYhgs5TyZgcXerXtp7UTiGhSjr/view?usp=sharing)

## Analysis Preparation

Required packages were loaded in advance using the *pacman* package (v`{r} utils::packageVersion("pacman")`) [@pacman]; check if packages are installed, if not, install them.

```{r Load packages}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
  "ggpubr",
  "pwrss",
  "parameters",
  "gargle",
  "cardx",
  "lme4",
  "ggalluvial",
  "tidyverse",
  "consort",
  "reshape",
  "future",
  "furrr",
  "memoise",
  "googlesheets4",
  "openxlsx2",
  "readr",
  "purrr",
  "tidyverse",
  "tidymodels",
  "tidytext",
  "stopwords",
  "tictoc",
  "lubridate",
  "forcats",
  "gt",
  "gtsummary",
  "flextable",
  "survival",
  "ggplot2",
  "ggdist",
  "ggsurvfit",
  "ggfortify",
  "mice",
  "marginaleffects",
  "patchwork",
  "naniar",
  "quantreg",
  "broom",
  "broom.helpers",
  "labelled",
  "epoxy",
  "broom.mixed",
  "lme4",
  "janitor",
  "progressr",
  "DT",
  install = TRUE,
  update = FALSE
)

```

## Authorisations

Access to study assets were pre-authorised using the *gargle* package (v`{r} utils::packageVersion("gargle")`) [@gargle] and *googledrive* (v`{r} utils::packageVersion("googledrive")`) [@googledrive].

```{r, echo = FALSE}

# Set the cache location
options(gargle_oauth_cache = ".secrets")

# Use the saved token for non-interactive auth
googledrive::drive_auth(email = "cscholes@ebma.com.au", 
          cache = ".secrets")

options(
  gargle_oauth_cache = ".secrets",
  gargle_oauth_email = TRUE
)

googledrive::drive_auth(cache = ".secrets", email = TRUE)
```

```{r, echo = FALSE}

options(
  gargle_oauth_cache = ".secrets",
  gargle_oauth_email = TRUE
)

googledrive::drive_auth(cache = ".secrets", email = TRUE)
```

## STROBE \[2\] Background

<!--# Provide a critical analysis of the background information on the research question or problem. -->

Background material has been provided in the linked reports (see Analysis Introduction).

Additional notes are included below;\

-   Urinary infection can potentially lead to hematogenous seeding of a prosthetic joint with bacteria, resulting in periprosthetic joint infection (PJI) [@meddings2010]

## STROBE \[3\] Objectives

<!--# Evaluate the clarity and significance of the study's objectives and hypotheses. -->

We sought to characterise the rate of patient reported urinary complications, and patient satisfaction with urinary management following elective hip and knee arthroplasty. Our secondary aim was to identify the patient and surgical factors predicting the incidence and severity of urinary complications following lower limb arthroplasty.

The study objectives have evolved over time. The original study question as per the study plan was the following;

+--------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Component    | Study-Specific                                                                                                                           |
+==============+==========================================================================================================================================+
| Population   | In patients electing to undergo hip or knee total arthroplasty with one of four participating surgeons in a metropolitan public hospital |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Intervention | How do those that report a change in urinary symptoms between pre-admission clinic and 21 days after surgery differ to                   |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Comparator   | Those that do not report a change in symptoms                                                                                            |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Outcomes     | Primary: In patient characteristics, baseline symptoms and management factors                                                            |
|              |                                                                                                                                          |
|              | Secondary: In satisfaction with urinary management/incidence of POUR at 2-week follow-up                                                 |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Study Design | Within an observational cohort design embedded into the SHARKS registry (QEII Orthopaedic Department)                                    |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------+

: Table 1a: Study *Question 1* as per study plan.

+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Component    | Study-Specific                                                                                                                                                                     |
+==============+====================================================================================================================================================================================+
| Population   | In patients electing to undergo hip or knee total arthroplasty with one of four participating surgeons in a metropolitan public hospital                                           |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Intervention | Receiving pre-emptive urinary catheterisation                                                                                                                                      |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Comparator   | Compared to those that do not                                                                                                                                                      |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Outcomes     | How do i) urinary symptoms as measured by the core lower urinary tract symptom score (CLSS) and ii) satisfaction with urinary management in-hospital at two weeks followup differ? |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Study Design | Within an observational cohort design embedded into the SHARKS registry (QEII Orthopaedic Department)                                                                              |
+--------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

: Table 1b: Study *Question 2*

### Hypotheses

+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Question  | Clinical                                                                                                                                                                       | Statistical                                                                                                                                                   |
+===========+================================================================================================================================================================================+===============================================================================================================================================================+
| 1         | 1.  Patients reporting an increase or appearance of lower urinary tract symptoms will possess a combination of risk factors, including                                         | H1: The predicted probability of a change in urinary symptoms by a multivariable model will be closer to actual probabilities than expected by chance         |
|           |                                                                                                                                                                                |                                                                                                                                                               |
|           |     1.  Symptoms prior to surgery                                                                                                                                              | H0: The predicted probability of a change in urinary symptoms by a multivariable model will **not be** closer to actual probabilities than expected by chance |
|           |                                                                                                                                                                                |                                                                                                                                                               |
|           |     2.  Catheterisation (planned vs unplanned)                                                                                                                                 |                                                                                                                                                               |
|           |                                                                                                                                                                                |                                                                                                                                                               |
|           |     3.  Comorbidities                                                                                                                                                          |                                                                                                                                                               |
|           |                                                                                                                                                                                |                                                                                                                                                               |
|           |     4.  Older age                                                                                                                                                              |                                                                                                                                                               |
|           |                                                                                                                                                                                |                                                                                                                                                               |
|           |     5.  Male gender                                                                                                                                                            |                                                                                                                                                               |
+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 1         | Patients with symptoms will tend to be less satisfied with the management received for managing POUR                                                                           |                                                                                                                                                               |
+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 2         | Patients receiving reactive catheterisation on the recovery ward in response to image-detected urinary retention will report worse CLSS and satisfaction at two week follow up | H1: The predicted probability of a postoperative urinary symptoms by a multivariable model will be closer to actual probabilities than expected by chance     |
|           |                                                                                                                                                                                |                                                                                                                                                               |
|           |                                                                                                                                                                                | H0: The predicted probability of a change in urinary symptoms by a multivariable model will **not be** closer to actual probabilities than expected by chance |
+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+

: Table 2: Study hypotheses for present analysis

# Methods:

## STROBE \[4\] Study Design:

<!--# Critically evaluate the appropriateness of the chosen observational study design (e.g., cohort, case-control). -->

Observational cohort study embedded into a department clinical quality registry for lower limb arthroplasty (SHARKS), with pre-post assessment of patient-reported outcomes.

## STROBE \[5\] Setting:

<!--# Assess the relevance and representativeness of the study setting. -->

The study setting is an orthopaedic department within a medium-sized metropolitan public hospital in a capital city of Australia. The analysis and data collection were sampled from all eligible arthroplasty cases from the commencement date of the study to the time of initial analysis. It is asserted that the setting is representative of orthopaedic care in Australia and possesses sufficient equivalence for consideration internationally.

## STROBE \[6\] Participants:

<!--# Critique the definition of the study population, including inclusion and exclusion criteria. -->

Patients were approached to participate if they were booked to undergoing primary lower limb total joint arthroplasty (hip or knee) within the orthopaedic department and were presenting for preoperative anaesthetic workup between November 2020 and June 2023 under the care of a surgeon contributing to the department registry (SHARKS).

Patients were excluded for the following reasons

-   Underwent surgery for different condition

-   Surgery was not primary

-   Surgery did not go ahead as planned (not rescheduled within recruitment time period) \| removed from surgery wait list

-   Comorbidity specific to the urinary system

-   Underwent surgery under the care of a consultant not contributing to the registry

-   Did not possess adequate English skills to answer the PROMs

## STROBE \[7\] Variables:

<!--# Evaluate the choice of exposure, outcome, and confounding variables. -->

Before the commencement of data collection, a [core dataset](https://docs.google.com/spreadsheets/d/1x3LChn3Zh7qPkVQ4rRM0MyjdpfpR-myoZp7oAkq_fKc/edit?usp=sharing "Study core dataset") for the study was derived and agreed to by the project investigators to establish the key variables for the study.

### Exposure

The primary exposure variable was the status of in-dwelling catheterisation prior to the arthroplasty procedure (*preemptive IDC*). Patients were pre-emptively catheterised based on the preference of the treating surgeon in collaboration with the attending anaesthetist.

The secondary exposure variable was the status of in-dwelling catheterisation as a treatment for *postoperative urinary retention* (POUR) detected immediately after the arthroplasty procedure.

POUR was defined clinically by the treating consultant in collaboration with the shift nursing staff.

### Outcome(s)

The primary outcome was the total score derived from the core lower urinary tract symptom score (CLSS) [@homma2008]. The CLSS is an 11-question self-reported questionnaire that provides overall assessment of relevant symptoms of the lower urinary tract.

### Model Covariates

Although there was an attempt to construct a DAG (directed acyclic graph) [@tennant2020] during the study plan, it was decided to revise the graph as part of this analysis. The *ggdag* package (v`{r} utils::packageVersion("ggdag")`) [@ggdag] combined with *ggplot2* (v`{r} utils::packageVersion("ggplot2")`) were used to create the DAG and calculate the minimum adjustment set, with *knitr* (v`{r} utils::packageVersion("knitr")`) [@knitr] used to display the figures.

The candidate variables were summarised in the table below

| Variable | Related to PreIDC | Related to Postop Symptoms | Comments |
|----|----|----|----|
| Age | Related to risk of POUR [@cha2020] | Assumed |  |
| Sex | Related to risk of POUR [@cha2020] | Assumed |  |
| BMI (Body Mass Index) | Associated with POUR in males [@scholten2018] | Unknown | Other studies have not detected relationship between BMI and POUR |
| Bilateral | Simultaneous bilateral procedures | Unknown |  |
| Joint | Related to risk of POUR [@peng2022] |  |  |
| BaseCLSS | Not seen by clinicians | Assumed | Included to reduce model standard errors |
| Comorbidities | Related to risk of POUR [@tischler2016] | Assumed |  |
| IntraopFluid | *Intent* or perceived likelihood of high volume may influence decision |  | Possible mediator variable |
| POUR | The perceived risk of POUR is likely a factor in decision | POUR occurrence assumed to be associated with PROMs | Possible mediator variable |
| IDCComplic | In-dwelling catheterisation increases infection risk [@ma2019] | Assumed | Possible mediator variable |
| SpinalAnaesthesia | Associated with POUR [@scholten2018] |  | Possible mediator variable; Unless decision to PreIDC is based on SpinalAnaes *intent* |

: Summary of candidate variables

Define the graph

```{r}

DAGCLSS <- ggdag::dagify(
  PostCLSS ~ PreIDC + Comorbidity + Sex + Age + Bilateral + Joint + BMI + BaseCLSS + POUR + IDCComplic + SpinalAnaesthesia,
  PreIDC ~ Age + Sex + BMI + SpinalAnaesthesia,
  Bilateral ~ Joint,
  BMI ~ Age + Sex + Comorbidity,
  Comorbidity ~ Age + Sex + BMI,
  BaseCLSS ~ Age + Sex + BMI + Comorbidity,
  POUR ~ Comorbidity + Sex + Age + Bilateral + Joint + BMI + SpinalAnaesthesia,
  IDCComplic ~ POUR + PreIDC + SpinalAnaesthesia + Age + Sex + Comorbidity,
  SpinalAnaesthesia ~ Joint + Bilateral + Comorbidity + Sex
)

# Create a tidy version of the DAG and apply custom labels
tidy_dag1 <- ggdag::tidy_dagitty(DAGCLSS, layout = "auto") |>
  mutate(label = case_when(
    name == "PostCLSS" ~ "Postop CLSS",
    name == "BaseCLSS" ~ "Baseline CLSS",
    name == "IDCComplic" ~ "IDC Complications",
    name == "Age" ~ "Age at\n Surgery",
    name == "SpinalAnaesthesia" ~ "Spinal",
    name == "Bilateral" ~ "Simultaneous\n Bilateral TJA",
    name == "Sex" ~ "Sex",
    name == "POUR" ~ "Postoperative\n Urinary Retention",
    name == "Comorbidity" ~ "Presence\n of Comorbidities",
    TRUE ~ name
  ))

Figure3 <- ggplot(
   tidy_dag1, 
   aes(
     x = x, 
     y = y, 
     xend = xend, 
     yend = yend)
   ) +
   ggdag::geom_dag_node(
     color = "darkblue", 
     fill = "lightblue", 
     alpha = 0.5, 
     size = 20) +
   ggdag::geom_dag_text(
     aes(
       label = label
       ), 
     color = "black", 
     fontface = "bold", 
     size = 3, 
     vjust = 0.5
     ) +
   ggdag::geom_dag_edges(
     edge_color = "gray50", 
     edge_width = 0.5, 
     #edge_arrow_size = 0.3
     ) +
   ggdag::theme_dag(
     base_size = 12,
     base_family = "",
     plot.background = element_rect(fill = "white"),
     panel.background = element_rect(fill = "white")
   ) +
   theme(
     plot.title = element_text(
       hjust = 0.5, 
       size = 16, 
       face = "bold"
       ),
     plot.margin = margin(
       20, 
       20, 
       20, 
       20
       )
   ) +
   ggtitle(
     "Directed Acyclic Graph"
     )
 
 knitr::knit_print(Figure3)

```

Create minimal adjustment set

```{r}
Figure4 <- ggdag::ggdag_adjustment_set(
  tidy_dag1,
  text = FALSE,
  #use_labels = "label"
  exposure = "PreIDC",
  outcome = "PostCLSS"
  ) +
  ggdag::geom_dag_node(
    color = "darkblue", 
    fill = "lightblue", 
    alpha = 0.7, 
    size = 10
  ) +
  # geom_dag_text(
  #   aes(label = label),  # Use the 'label' column directly
  #   color = "black", 
  #   fontface = "bold", 
  #   size = 3, 
  #   vjust = -1.5,  # Adjust vertical position
  #   hjust = 1.5,  # Adjust horizontal position
  #   show.legend = FALSE  # Prevent text from appearing in legend
  # ) +
  ggdag::geom_dag_label_repel(
    aes(label = label, fill = adjusted),
    color = "white",
    fontface = "bold",
    size = 3,
    show.legend = FALSE,
    box.padding = unit(0.5, "lines"),  # Padding around labels
    point.padding = unit(0.5, "lines"),  # Padding around points
    nudge_y = 0.5,  # Adjust vertical nudge
    nudge_x = 0.5   # Adjust horizontal nudge
  ) +
  ggdag::geom_dag_edges(
    edge_color = "gray50", 
    edge_width = 0.5
  ) +
  ggdag::theme_dag(
    base_size = 10,
    base_family = "",
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white")
  ) +
  theme(
    plot.title = element_text(
      hjust = 0.5, 
      size = 10, 
      face = "bold"
    ),
    plot.margin = margin(20,20,20,20),
    legend.position = "bottom",
    legend.background = element_rect(fill = "white", color = "gray80"),
    legend.title = element_text(face = "bold")
  ) +
  ggtitle("Adjustment Set for Directed Acyclic Graph")


knitr::knit_print(Figure4)
```

## STROBE \[8\] Data Sources/Measurement

Data for the study were retrieved in the first instance to a cloud-based file (Sheets, Google LLC, USA). A web-based form (Forms, Google LLC, USA) was generated to recreate It comprised the following tables;

-   MasterSheet

-   

### Data Import and Preparation

Data was retrieved from the live study file using *googlesheets4* (v`{r} utils::packageVersion("googlesheets4")`) [@googlesheets4].

```{r, echo = FALSE}

SheetID = "https://docs.google.com/spreadsheets/d/1Q7u3-5Q7q94pI2Vq4FAOHNya0upf4vcbK3A5b2twXtU/edit"

```

```{r Study Table Import}

# Authenticate for sheets using the same token
googlesheets4::gs4_auth(token = googledrive::drive_token())

Master <- googlesheets4::range_read(
  ss = SheetID,
  sheet = "Mastersheet",
  range = "A3:AW",
  col_names = TRUE,
  col_types = "TccccDcccnncccccccncDDcnccttnccTTcTTTnnnccnnccicc",
  trim_ws = TRUE
)

MasterFilter <- googlesheets4::range_read(
  ss = SheetID,
  sheet = "MasterFilter",
  range = "A1:BU",
  col_names = TRUE,
  col_types = "TccccDcccnncccccccncTDcnccttnccTTcTTTnnnccnncccccccccccccccccccccccciiccn",
  trim_ws = TRUE
)

```

The imported tables were reorganised to create STROBE flowchart using *tidyverse* (v`{r} utils::packageVersion("tidyverse")`) [@tidyverse]. The *stringr* package (v`{r} utils::packageVersion("stringr")`) [@stringr] was used to recode new variables.

```{r}

STROBEFlow <- Master |> dplyr::filter(
  !is.na(URN) & stringr::str_detect(Consent,"Test", negate = TRUE)
) |> dplyr::select(
  URN,
  Consent,
  Status1,
  Status2,
  `Baseline CLSS - Total Score`,
  `Postoperative CLSS - Total score`,
  `Date of surgery`,
  `Operated Joint`
) |> dplyr::mutate(
    exclusion1 = dplyr::if_else( #exclusion before induction
    stringr::str_detect(Consent,"Completed"), NA_character_, stringr::str_split_i(Status1,"; ", 2)
    ),
  exclusion2 = case_when( #exclusion after induction
    Consent == "Completed" & is.na(Status1) ~ NA_character_,
    Consent == "Completed" & !is.na(Status1) ~ stringr::str_split_i(Status1,"; ", 2),
    Consent != "Completed" ~ NA_character_
  ),
  induction = dplyr::if_else(Status2 == "Complete",URN,NA_character_), #chart review completed
  followup = case_when( #expectation of CLSS follow up
    !is.na(induction) & !is.na(exclusion2) ~ NA_character_,
    is.na(induction) ~ NA_character_,
    .default = URN
),
 assessed = case_when(
   !is.na(induction) & !is.na(followup) & !is.na( `Postoperative CLSS - Total score`) ~ URN,
   .default = NA_character_
 ),
lost_followup = if_else(!is.na(followup) & is.na(assessed),"Lost to followup",NA_character_),
CombID = if_else(!is.na(followup), 
  stringr::str_c(
    URN,
    as.numeric(`Date of surgery`),
    `Operated Joint`
  ), NA_character_
)
)|> dplyr::rename(
  trialno = "URN"
)

```

Further manipulations were performed using *tidyverse* to clean the data for input into a recruitment flowchart [@Vandenbroucke2007].

```{r}

STROBEFlow2 <- STROBEFlow |> dplyr::filter(
  !is.na(CombID) & Consent == "Completed"
)

MasterFilter2 <- MasterFilter |> dplyr::mutate(
  CombID = stringr::str_c(
    URN,
    as.numeric(`Date of surgery`),
    `Operated Joint`
  ),
  Surgeon = case_when(
    Surgeon == "McLean" ~ "McLean Andrew",
    Surgeon == "Calabro Lorzenzo" ~ "Calabro Lorenzo",
    .default =  stringr::str_to_title(stringr::str_squish(Surgeon))
  ),
  Surgeon1 = case_when(
    Surgeon == "Calabro Lorenzo" ~ "A",
    Surgeon == "Fitzpatrick Prudence" ~ "B",
    Surgeon == "Bell Christopher" ~ "C",
    Surgeon == "Balendra Ganesh" ~ "D",
    Surgeon == "Meta Mahendra" ~ "E",
    Surgeon == "McLean Andrew" ~ "F"
  ),
  Surgeon2 = forcats::fct(Surgeon1,
                          levels = c(
                            "A","B","C","D","E","F"
                          )),
  UrineMCS = stringr::str_to_title(`Urine MCS result`),
  AnalgesicStrategy2 = dplyr::if_else(
    `Analgesic strategy` == "Fentanyl/Bupivicaine", "Yes","No"
  ),
  AnaesthesiaType2 = dplyr::if_else(
    stringr::str_detect(`Anaesthesia type`, "Spinal"), "Yes", "No"
  ),
  SurgicalDuration = `Surgical time (mins)` * 24 * 60
  ) |>  dplyr::filter(
  CombID %in% STROBEFlow2$CombID
) |> dplyr::rename(
  AgeAtSurgery = "Age at surgery",
  Joint = "Operated Joint",
  Sex = "Gender"
)
  
```

The master dataset was converted to *long* format using *tidyr* (v`{r} utils::packageVersion("tidyr")`) [@tidyr] to enable plotting of PROMs data between pre and post arthroplasty timepoints.

```{r}
MasterPROM1 <- MasterFilter |> dplyr::mutate(
  CombID = stringr::str_c(
    URN,
    as.numeric(`Date of surgery`),
    `Operated Joint`
  )
) |> dplyr::select(
  CombID,
  contains ("CLSS")
) |> dplyr::rename(
  CLSSTotal_Pre = "Baseline CLSS - Total Score",
  CLSSTotal_Post = "Postoperative CLSS - Total score",
  CLSSSat_Pre = "Baseline CLSS - Satisfaction",
  CLSSSat_Post = "Postoperative CLSS - Satisfaction",
) |> mutate(
  CLSSSat_Pre = dplyr::if_else(stringr::str_detect(CLSSSat_Pre,"Mixed"),"Mixed",CLSSSat_Pre),
  CLSSSat_Post = dplyr::if_else(stringr::str_detect(CLSSSat_Post,"Mixed"),"Mixed",CLSSSat_Post),
  CLSSQ11_Pre = dplyr::if_else(stringr::str_detect(CLSSQ11_Pre,"Mixed"),"Mixed",CLSSQ11_Pre),
  CLSSQ11_Post = dplyr::if_else(stringr::str_detect(CLSSQ11_Post,"Mixed"),"Mixed",CLSSQ11_Post)
) |> dplyr::mutate(
  across(c(CLSSQ1_Pre,CLSSQ1_Post),~forcats::fct_relevel(., "~7", "8~9", "10~14", "15~")),
  across(c(CLSSQ2_Pre,CLSSQ2_Post),~forcats::fct_relevel(., "0", "1", "2~3", "4~")),
  across(c(CLSSQ3_Pre:CLSSQ10_Pre,CLSSQ3_Post:CLSSQ10_Post),~forcats::fct_relevel(., "No", "Rarely", "Sometimes", "Often"))
)
```

The data were further refined for input into regression models by handling the numeric and character data types separately. The *forcats* package (v`{r} utils::packageVersion("forcats")`) [@forcats] was used to convert character columns to factors.

```{r}



# First handle the Total scores (numeric)
CLSSTotal <- tidyr::pivot_longer(
    data = MasterPROM1 |> dplyr::select(
      CombID,
      starts_with("CLSSTotal")
    ),
    cols = starts_with("CLSSTotal"),
    names_pattern = "CLSSTotal_(Pre|Post)",
    names_to = "Timepoint",
    values_to = "Total"
  ) |> dplyr::mutate(
    Timepoint = forcats::fct(Timepoint, levels = c("Pre", "Post"))
  )

# Then handle the question responses (character)
CLSSQuestion <- tidyr::pivot_longer(
  data = MasterPROM1 |> dplyr::select(
    CombID,
    starts_with(c(
      "CLSSSat",
      "CLSSQ"
      )
    )
),
    cols = starts_with("CLSS"),
    names_pattern = "CLSS(Sat|Q\\d+)_(Pre|Post)",
    names_to = c("Question", "Timepoint"),
    values_to = "Score"
  ) |> dplyr::mutate(
    Timepoint = forcats::fct(Timepoint, levels = c("Pre", "Post"))
  )


```

The master dataset was sliced down to the minimal inputs required for model generation.

```{r}
CLSSTotal2 <- dplyr::left_join(
  CLSSTotal,
  MasterFilter2 |> dplyr::select(
    CombID,
    AgeAtSurgery,
    Sex,
    Bilateral,
    Joint,
    `Pre-emptive IDC`,
    `Reactive IDC insertion`
  ),
  by = "CombID"
)
```

## STROBE \[9\] Bias:

<!--# Critically analyze potential sources of bias and the adequacy of methods used to address them. -->

Retrospective cohort analyses are subject to a number of biases as noted by [@sedgwick2014]. Specific to this analysis, the following considerations are noted below.

Table 9: Biases in analysis of an observational cohort.

+-------------------+-------------------------------------------------------------------------------------------------+---------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Bias              | Definition                                                                                      | Source                    | Mitigation                                                                                                                                                                  |
+===================+=================================================================================================+===========================+=============================================================================================================================================================================+
| Selection         | Patient recruitment is such that the sample becomes unrepresentative of population              | [@sedgwick2014]           | The SHARKS registry represents \~70% of cases performed in the department. All patients eligible for recruitment during the recruitment period were approached for consent. |
|                   |                                                                                                 |                           |                                                                                                                                                                             |
|                   |                                                                                                 |                           | The proportion of non-english speaking patients in the hospital population remains unmitigated as a source of bias                                                          |
+-------------------+-------------------------------------------------------------------------------------------------+---------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Information bias  | Patient responses are systematically different from reality                                     | [@sedgwick2014]           | Considering the subject matter and the method of PROMs collection, information bias cannot be fully mitigated in this sample.                                               |
|                   |                                                                                                 |                           |                                                                                                                                                                             |
|                   |                                                                                                 |                           | Optimism correction was simulated as part of sensitivity analysis to investigate the potential of this source of bias                                                       |
+-------------------+-------------------------------------------------------------------------------------------------+---------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Confounder        | A variable of interest and a target outcome simultaneously influenced by a third variable       | [@tennant2020]            | Regression models were used to adjust models for estimated confounders identified through minimal adjustment sets using directed acyclic graphs.                            |
+-------------------+-------------------------------------------------------------------------------------------------+---------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Missing data      | The absence of a data value where a treatment record is eligible to have a data value collected | [@carroll2020]            | Missingness in PROMs date was addressed with multiple imputation (see Missing Data)                                                                                         |
+-------------------+-------------------------------------------------------------------------------------------------+---------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Pseudoreplication | Analyse data while ignoring dependency between observations. Inadequate model specification.    | [@davies2015; @lazic2010] | Used mixed effects linear model for procedure duration with patient identifier as random effect. Cluster for patient in survival (all-cause failure and retear).            |
+-------------------+-------------------------------------------------------------------------------------------------+---------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

## Missing Data

Missingness is an unavoidable characteristic of clinical datasets, particularly in a public hospital setting where patients from lower socioeconomic backgrounds are less likely to respond to patient-reported outcome measures in lower limb arthroplasty [@konopka2023].

#### Assessment

The *naniar* package (v`{r} utils::packageVersion("naniar")`) [@naniar] and *gt* (v`{r} utils::packageVersion("gt")`) packages were used to generate a summary table of missingness CLSSTotal. No other variables relevant to the regression were missing values. Importantly, even though the proportion of missingness is relatively low (\<10% for postoperative assessment), this should not be used as a guide with respect to deciding whether to use imputation [@madley-dowd2019].

```{r}

CLSSTotal2 |> dplyr::select(
  Timepoint,
  Total
) |> group_by(Timepoint) |>
miss_case_table() |> gt::gt() |> 
  gt::fmt_number(
  columns = pct_cases,
  decimals = 2
  )

```

#### Management

Multiple imputation under the assumption of *missing at random* as described in [@cro2020]. The *mice* (v`{r} utils::packageVersion("mice")`) [@mice] was used to impute the dataset.

```{r}

CLSSModelInput <- MasterFilter2 |> dplyr::select(
    CombID,
    AgeAtSurgery,
    Sex,
    BMI,
    Bilateral,
    Joint,
    `Pre-emptive IDC`,
    `Reactive IDC insertion`,
    `Baseline CLSS - Total Score`,
    `Postoperative CLSS - Total score`,
    `Anaesthesia type`
) |> dplyr::mutate(
  Spinal = if_else(
    stringr::str_detect(`Anaesthesia type`,"Spinal"),
    "Yes",
    "No"
    )
  )|> dplyr::rename(
      PreIDC = "Pre-emptive IDC",
    ReactIDC = "Reactive IDC insertion",
    BaseCLSS = "Baseline CLSS - Total Score",
    PostCLSS = "Postoperative CLSS - Total score"
) |> dplyr::select(
  -`Anaesthesia type`
)

```

```{r}

# First create your predictor matrix as before
predM <- mice::make.predictorMatrix(CLSSModelInput)

# Switch off IDs from predicting
predM[,"CombID"] <- 0 
predM["CombID",] <- 0


# Create a method vector
meth <- mice::make.method(CLSSModelInput)

# Modified mice command including method specification
MasterImp <- mice::mice(
  CLSSModelInput,
  maxit = 10,
  seed = 4218,
  m = 20,
  printFlag = FALSE,
  predictorMatrix = predM,
  method = meth
  )
```

A strip plot (Figure 3) were used to visually inspect the convergence of the imputation iterations against the original dataset.

```{r Density Plot, eval = FALSE}

mice::densityplot(MasterImp)


```

```{r Strip Plot}
plot(MasterImp)

```

Figure 3: Strip plot of imputed data over 5 iterations with 20 imputations per iteration.

The estimated PCS-SF total score from the imputation model versus the distribution of the observed PCS-SF was plotted as a visual inspection of the imputation result using *ggplot2* (v`{r} utils::packageVersion("ggplot2")`)[@ggplot2] (Figure 4).

```{r}
ggplot() +
  geom_density(data = complete(MasterImp, 1), aes(x = PostCLSS, color = "Observed")) +
  geom_density(data = complete(MasterImp, 2:10), aes(x = PostCLSS, color = "Imputed")) +
  labs(title = "CLSS Total: Observed vs. Imputed Distributions")
```

Figure 4. Estimated versus observed CLSS Total for the analysis cohort.

## STROBE \[10\] Study size:

<!--# *Critically analyze the final study sample and the rationale/methods used for its justification.* -->

The original study sample calculation (Study Plan) estimated that *330* cases would be required to answer Question 1.

Due to delays associated with elective surgery restrictions as part of COVID19 mitigation strategies and rotation of key personnel associated with the study away from the hospital, the sample was restricted to `nrow(MasterFilter)`. The *pwrss* package (v`{r} utils::packageVersion("pwrss")`) [@pwrss] was used to estimate the power available for the intended regression model to answer Question 2 under the following assumptions.

-   Effect size = small

-   Factor levels = 2

-   Covariates = 4 (see data model)

-   n = 286

```{r}

ANCOVA2 <- pwrss.f.ancova(
  eta2 = 0.03, # "small" effect size for variable of interest
  #f2 = eta2 / (1 - eta2),
  n.levels = 2, 
  #n.way = length(n.levels),
  n.covariates = 4, 
  alpha = 0.05,
  n = 286, 
  #power = 0.8, 
  verbose = FALSE)
```

```{epoxy}

Power for the 2-group comparison was {round(as.numeric(ANCOVA2$power),2)}.

The available sample size should be sufficient to answer the question posed, under the assumptions of the data model proposed here.
```

## STROBE \[11\] Quantitative variables:

<!--# *Evaluate the analytical choices of the quantitative variables within the dataset.* -->

To answer Question 1, a minimal clinically important difference is required for the CLSS. In the original study protocol, a 2-point difference was put forward as a difference sufficient to represent clinically meaningful change in the CLSS Total score (\~10%).

## STROBE \[12\] Statistical Methods:

<!--# *Evaluate the appropriateness and robustness of the statistical techniques used for analysis.* -->

The participant flow chart was generated using the *consort* package (see STROBE 8).

Baseline data was compared between groups of preemptive IDC (Yes \| No) using student t-test for continuous variables and fisher exact test (binary categorical) or chi-square test (categorical with \>2 categories) with correction for ties. Correction for multiple comparisons was implemented with the *Holm* method using the *gtsummary* package (v`{r} utils::packageVersion("gtsummary")`) [@gtsummary].

Complete case analysis of the CLSS Total involved an unadjusted comparison between pre and post scores using a paired t-test.

A linear model was fitted to the imputed data using *stats* (v`{r} utils::packageVersion("stats")`) [@stats] with the following form.

```{r, echo = TRUE}

CLSSMod <- with(
  MasterImp, 
  exp = lm(PostCLSS ~ PreIDC + BaseCLSS + Bilateral + Sex + AgeAtSurgery)
    )


    
```

The model was summarised using *gtsummary*. Predicted values for all model variables were generated from the model object using *marginaleffects* (v`{r} utils::packageVersion("marginaleffects")`) [@marginaleffects].

# Results:

## STROBE \[13\] Participant Flow:

<!--# *Critically assess the transparency and completeness of participant flow reporting.* -->

```{r}
STROBEplot <- consort::consort_plot(
  data = STROBEFlow,
  orders = c(
    trialno = "Population",
    exclusion1 = "Screened Out",
    trialno = "Recruited",
    induction = "Chart review",
    exclusion2 = "Excluded",
    followup = "Eligible for CLSS",
    lost_followup = "Not evaluated",
    assessed = "Followup CLSS returned"
  ),
  side_box = c(
    "exclusion1",
    "exclusion2",
    "lost_followup"
  ),
  cex = 0.8
)

knitr::knit_print(STROBEplot)

```

## STROBE \[14\] Descriptive Data:

<!--# *Evaluate the adequacy of the presentation of characteristics of the study population.* -->

```{r}

TableSummary1 <- gtsummary::tbl_summary(
  data = MasterFilter2,
  include = c(
    "AgeAtSurgery",
    "BMI",
    "Sex",
    "Bilateral",
    "Joint",
    "Surgeon2",
    "Comorbidities - diabetes",
    "Comorbidities - cardiovascular",
    "Comorbidities - neurological",
    "Comorbidities - previous urologic surgery",
    "UrineMCS"
  ),
  label = list(
    AgeAtSurgery = "Age at surgery",
    Surgeon2 = "Surgeon"
  ),
  type = list(
    Bilateral ~ "dichotomous"
    ),
  value = list(
    Bilateral = "Bilateral"
  ),
  statistic = list(
    all_continuous() ~ "{mean} ({sd})",
    all_categorical() ~ "{p}% ({n})"
    ),
  digits = list(
    all_continuous() ~ 1,
    all_categorical() ~ c(1,0)
  )
)

knitr::knit_print(TableSummary1)

```

```{r}

TableSummary2 <- gtsummary::tbl_summary(
  data = MasterFilter2,
  include = c(
    "AgeAtSurgery",
    "BMI",
    "Sex",
    "Bilateral",
    "Joint",
    "Surgeon2",
    "Comorbidities - diabetes",
    "Comorbidities - cardiovascular",
    "Comorbidities - neurological",
    "Comorbidities - previous urologic surgery",
    "UrineMCS",
    "AnalgesicStrategy2",
    "Intraop fluid (mL)",
    "AnaesthesiaType2",
    "SurgicalDuration",
    "Routine IDC insertion",
    "Reactive IDC insertion"
  ),
  by = `Routine IDC insertion`,
  label = list(
    AgeAtSurgery = "Age at surgery",
    Surgeon2 = "Surgeon",
    AnalgesicStrategy2 = "Fentanyl - Bupivicaine",
    AnaesthesiaType2 = "Spinal anaesthesia"
  ),
  type = list(
    Bilateral ~ "dichotomous",
    Sex ~ "dichotomous",
    UrineMCS ~ "dichotomous"
    ),
  value = list(
    Bilateral = "Bilateral",
    Sex = "Female",
    UrineMCS = "Bacteriuria"
  ),
  statistic = list(
    all_continuous() ~ "{mean} ({sd})",
    all_categorical() ~ "{p}% ({n})"
    ),
  digits = list(
    all_continuous() ~ 1,
    all_categorical() ~ c(1,0)
  )
) |> add_overall() |> add_ci(
  statistic = list(
    all_continuous() ~ "{conf.low} - {conf.high}",
    all_categorical() ~ "{conf.low} - {conf.high}"),
) |> add_p(
  test = list(
    all_continuous() ~ "t.test"
    )
) |> add_q(method = "holm")

knitr::knit_print(TableSummary2)

```

```{epoxy}



```

## STROBE \[15\] Outcome Data:

<!--# *Evaluate the adequacy of the presentation of outcome data (over time).* -->

<!--# *Need to adjust the summary stat labels on x axis* -->

```{r}
CLSSTotal1 <- ggplot(data = CLSSTotal, mapping = aes(y = Total, x = Timepoint)) +
  stat_halfeye(aes(thickness = after_stat(pdf*n)), scale = 0.7) +
  stat_summary(fun.data = function(x) {
    data.frame(
      y = mean(x), # Position at the mean
      label = sprintf("%.1f ± %.1f", mean(x), sd(x))
    )
  }, geom = "text" 
  ) +  scale_fill_brewer(palette = "Set2") +
  ggtitle('Core Lower Urinary Tract Symptom Score') + 
  ylab("Total Score") 

```

Annotate the results of a paired t-test onto the figure

```{r}

# Compare with paired t-test



CLSSCCA <- stats::t.test(
  MasterFilter$`Baseline CLSS - Total Score`,
  MasterFilter2$`Postoperative CLSS - Total score`,
  paired = TRUE
)

# Add the annotation with the p-value from your t-test
CLSSTotal1a <- CLSSTotal1 + 
  annotate(
    "text", 
    x = 1.5, # Position between the two timepoints
    y = max(CLSSTotal$Total, na.rm = TRUE) * 0.95, # Position at 95% of the maximum y value
    label = sprintf("Paired t-test, p = %.3f", CLSSCCA$p.value),
    hjust = 0.5, # Center align
    size = 3.5, # Text size
    fontface = "italic"
  )

knitr::knit_print(CLSSTotal1a)
```

Figure 2: Summary of CLSS total score before and after lower limb arthroplasty (complete case analysis)

```{r}

CLSSPlot1Dat <- CLSSQuestion |> dplyr::filter(
  Question == "Q1" & !is.na(Score)
) |> dplyr::summarise(
  count = n(),
  .by = c(Score,Timepoint)
) |> dplyr::group_by(
  Timepoint
  ) |> dplyr::mutate(
  Percentage = (count / sum(count)) * 100,
  Response = forcats::fct(Score, levels = c("~7", "8~9", "10~14", "15~")),
) |> dplyr::ungroup()

CLSSPlot2Dat <- CLSSQuestion |> dplyr::filter(
  Question == "Q2" & !is.na(Score)
) |> dplyr::summarise(
  count = n(),
  .by = c(Score,Timepoint)
) |> dplyr::group_by(
  Timepoint
  ) |> dplyr::mutate(
  Percentage = (count / sum(count)) * 100,
  Response = forcats::fct(Score, levels = c("0", "1", "2~3", "4~")),
) |> dplyr::ungroup()

# CLSSPlot310Dat <- CLSSQuestion |> dplyr::filter(
#   stringr::str_detect(Question,"3|4|5|6|7|8|9|10") & !is.na(Score)
# ) |> dplyr::group_by(
#     Question
#   ) 

# |> dplyr::summarise(
#   count = n(),
#   .by = c(Score,Timepoint)
# ) |> dplyr::group_by(
#   Timepoint
#   ) |> dplyr::mutate(
#   Percentage = (count / sum(count)) * 100,
#   Response = forcats::fct(Score, levels = c("0", "1", "2~3", "4~")),
# ) |> dplyr::ungroup()

CLSSPlot1 <- ggplot(CLSSPlot1Dat, aes(fill=Response, y=Percentage, x=Timepoint)) +
    geom_bar(position="stack", stat="identity") +
    scale_y_continuous(labels = function(x) paste0(x, "%")) +
    labs(y = "Percentage") +
    ggtitle("Daily Frequency")

CLSSPlot2 <- ggplot(CLSSPlot2Dat, aes(fill=Response, y=Percentage, x=Timepoint)) +
    geom_bar(position="stack", stat="identity") +
    scale_y_continuous(labels = function(x) paste0(x, "%")) +
    labs(y = "Percentage") +
    ggtitle("Nightly Frequency")

CLSSPlot1 + CLSSPlot2

```

*Do the responses remain stable at the individual level.*

A function was constructed with the *ggplot2* and *ggalluvial* packages (v`{r} utils::packageVersion("ggalluvial")`) [@ggalluvial] to plot the individual changes in categorical responses in each CLSS question between baseline and postoperative assessments.

```{r}

plot_individual_transitions <- function(data, question, custom_title = NULL) {
  # Prepare data for alluvial plot
  transitions_data <- data %>%
    dplyr::filter(Question == question & !is.na(Response)) %>%
    dplyr::select(CombID, Timepoint, Response) %>%
    dplyr::mutate(
      Timepoint = factor(Timepoint, levels = c("Pre", "Post")),
      #Score = factor(Score, levels = unique(Response))  # Preserve order
    )
  
  # Set title - use custom title if provided, otherwise use default
  plot_title <- if (!is.null(custom_title)) {
    stringr::str_c("Individual Patient Transitions -", question, custom_title, sep = " ")
  } else {
    paste("Individual Patient Transitions -", question)
  }
  
  # Create alluvial plot
  ggplot(transitions_data,
         aes(x = Timepoint, stratum = Response, alluvium = CombID, 
             fill = Response, label = Response)) +
        ggalluvial::geom_flow(alpha = 0.5) +
    geom_stratum(alpha = 0.8) +
    geom_text(stat = "stratum", size = 3) +
    theme_minimal() +
    theme(
      legend.position = "none",
      panel.grid.major.x = element_blank(),
      panel.grid.minor = element_blank(),
      axis.text.y = element_blank()
    ) +
    labs(
      title = plot_title,
      subtitle = paste("n =", length(unique(transitions_data$CombID))),
      x = "Timepoint",
      y = "Number of Patients"
    ) +
    scale_x_discrete(expand = c(0.1, 0.1))
}

```

```{r}

CLSSTransQ1 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q1"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("~7", "8~9", "10~14", "15~"))
  ), 
  "Q1",
  "Daily Frequency")

knitr::knit_print(CLSSTransQ1)
```

```{r}
CLSSTransQ2 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q2"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("0", "1", "2~3", "4~"))
  ), 
  "Q2",
  "Nightly Frequency"
  )

knitr::knit_print(CLSSTransQ2)
```

```{r}
CLSSTransQ3 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q3"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q3",
  "Urination Desire"
  )

knitr::knit_print(CLSSTransQ3)
```

```{r}
CLSSTransQ4 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q4"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q4",
  "Leakage"
  )

knitr::knit_print(CLSSTransQ4)
```

```{r}
CLSSTransQ5 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q5"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q5",
  "Leakage - Cough/Sneeze"
  )

knitr::knit_print(CLSSTransQ5)
```

```{r}
CLSSTransQ6 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q6"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q6",
  "Slow Stream"
  )

knitr::knit_print(CLSSTransQ6)
```

```{r}
CLSSTransQ7 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q7"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q7",
  "Need to strain"
  )

knitr::knit_print(CLSSTransQ7)
```

```{r}
CLSSTransQ8 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q8"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q8",
  "Feeling incomplete emptying"
  )

knitr::knit_print(CLSSTransQ8)
```

```{r}
CLSSTransQ9 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q9"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q9",
  "Pain Bladder"
  )

knitr::knit_print(CLSSTransQ9)
```

```{r}
CLSSTransQ10 <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Q10"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("No", "Rarely", "Sometimes", "Often"))
  ), 
  "Q10",
  "Pain Urethra"
  )

knitr::knit_print(CLSSTransQ10)
```

```{r}
CLSSTransSat <- plot_individual_transitions(
  CLSSQuestion |> dplyr::filter(
    Question == "Sat"
  ) |> dplyr::mutate(
    Response = forcats::fct(Score, levels = c("Terrible", "Unhappy", "Mostly dissatisfied", "Mixed","Mostly satisfied", "Pleased", "Delighted"))
  ), 
  "Sat",
  "Symptom Satisfaction"
  )

knitr::knit_print(CLSSTransSat)
```

## STROBE \[16\] Main Results:

*Critically analyze the presentation and interpretation of primary findings, including effect estimates and confidence intervals.*

Regression Results - Q2

```{r}

CLSSTotal3 <- CLSSTotal2 |> mutate(
  Timepoint1 = if_else(
    Timepoint == "Pre", 0,1
  ),
  PreIDC = if_else(
    `Pre-emptive IDC` == "No", 0,1
  )
)

```

Complete case analysis regression was performed as per the model covariates (see STROBE \[7\] Variables).

```{r}

CLSSModCCA <- lm(
  PostCLSS ~ PreIDC + BaseCLSS + Bilateral + Sex + AgeAtSurgery,
  CLSSModelInput
  )

```

```{r}

TableCLSSCCA <- gtsummary::tbl_regression(
  CLSSModCCA,
  pvalue_fun = label_style_pvalue(digits = 2),
  show_single_row = c(
    "PreIDC",
    "Bilateral",
    "Sex"
  ) 
  ) |> add_global_p()

knitr::knit_print(TableCLSSCCA)


```

Model results from the imputed dataset was summarised using *gtsummary*.

```{r}

TableCLSSImpFull <- gtsummary::tbl_regression(
  CLSSMod,
  show_single_row = c(
    "PreIDC",
    "Bilateral",
    "Sex"
  ) 
  ) 

knitr::knit_print(TableCLSSImpFull)


```

Predictions were generated from the model using *marginaleffects* and summarised in a plot with *ggplot2*.

```{r}

# Calculate marginal means
CLSSPredict1 <- marginaleffects::predictions(
  CLSSMod,
  type = "response"
  ) 


```

```{r}
CLSSprPlot1 <- ggplot(data = CLSSPredict1, mapping = aes(y = PreIDC, x = PostCLSS, fill = Sex)) + stat_slabinterval(
  aes(thickness = after_stat(pdf*n)), 
  scale = 0.7,
  alpha = 0.7,
  position = "dodge"
  ) +
  # stat_dotsinterval(
  #   side = "top", 
  #   scale = 0.7, 
  #   slab_linewidth = NA,
  #   position = position_dodge(width = 0.7)
  #   ) +
  scale_fill_brewer(
    palette = "Set2"
    ) +
  ggtitle(
    'CLSS Predicted by Timepoint and Group'
    )

knitr::knit_print(CLSSprPlot1)
```

## STROBE \[17\] Other Analyses:

*Critically analyze the presentation and interpretation of subgroups, interactions or the description and evaluation of sensitivity analyses.*

A sensitivity analysis was performed by removing cases with a Reactive IDC from the imputed dataset and rerunning the regression.

```{r}
CLSSModSens <- with(
  MasterImp,
  stats::lm(PostCLSS ~ PreIDC + BaseCLSS + Bilateral + Sex + AgeAtSurgery, 
             subset = ReactIDC == "No")
)
```

```{r}

TableCLSSImpSens <- gtsummary::tbl_regression(
  CLSSModSens,
  tidy_fun = pool_and_tidy_mice,
  estimate_fun = function(x) style_number(x, digits = 2), 
  pvalue_fun = function(x) style_pvalue(x, digits = 3),
    show_single_row = c(
    "PreIDC",
    "Bilateral",
    "Sex"
  ) 
)  

knitr::knit_print(TableCLSSImpSens)
```

Predictions were generated from the model and summarised.

```{r}

# Calculate marginal means
CLSSPredict2 <- marginaleffects::predictions(
  CLSSModSens,
  type = "response"
  ) 


```

```{r}
CLSSprPlot2 <- ggplot(data = CLSSPredict2, mapping = aes(y = PreIDC, x = PostCLSS, fill = Sex)) + stat_slabinterval(
  aes(thickness = after_stat(pdf*n)), 
  scale = 0.7,
  alpha = 0.7,
  position = "dodge"
  ) +
  # stat_dotsinterval(
  #   side = "top", 
  #   scale = 0.7, 
  #   slab_linewidth = NA,
  #   position = position_dodge(width = 0.7)
  #   ) +
  scale_fill_brewer(
    palette = "Set2"
    ) +
  ggtitle(
    'CLSS Predicted by Timepoint and Group'
    )

knitr::knit_print(CLSSprPlot2)
```

The regression tables from the original complete case analysis, the imputed full dataset and the sensitivity analysis (ReactIDC removed) were merged.

```{r}

# merge tables
CLSSRegMerge <-
  tbl_merge(
    tbls = list(TableCLSSCCA, TableCLSSImpFull,TableCLSSImpSens),
    tab_spanner = c("Complete Case","ImputFull", "ImputSensitivity")
  )

knitr::knit_print(CLSSRegMerge)

```

# Discussion:

## STROBE \[18\] Key Results:

*Critically interpret the findings in the context of the study objectives.*

-   Patient reported urinary symptoms appears to undergo little change before and after lower limb joint arthroplasty (paired t-test; alluvian plots of individual questions CLSS)

-   Whether the operating surgeon chooses to preemptively catheterise a patient prior to the arthroplasty procedure is not significantly associated with patient-reported urinary symptoms at \~2 weeks after lower limb joint arthroplasty (regression analysis)

-   Whether a patient undergoes a reactive catheterisation for treatment of POUR may have a moderate relative influence on short-term patient-reported urinary symptoms. (sensitivity analysis of regression)

## STROBE \[19\] Limitations:

*Provide a thorough critique of the limitations of the study design, methods, and data.*

-   The psychometric properties of the CLSS have not been fully elucidated in this specific population

-   The model may not be sufficiently complex to capture the nuances of different trajectories in at-risk sub-groups

-   Electronic data capture may have excluded certain subgroups from participating in the study

-   COVID lockdowns impacted recruitment and particularly data collection patterns (phone, rather than electronic link). This may have contributed to measurement error in the postoperative CLSS and within-patient variability from baseline to post assessments.

-   Lack of blinding of analysis may contribute to bias; mitigated through structured approach to data model and analysis

## STROBE \[21\] Generalizability:

*Evaluate the strength of evidence supporting the external validity of the findings.*

-   The patient demographics are comparable to the literature \[Need to Check\]

-   The procedure volume is comparable \[Need to Check\]

-   The rate of POUR + ReactiveIDC is comparable \[Need to Check\]

-   Baseline CLSS is reasonable for the demographics of the sample \[Need to Check\]

## Comparison with Existing Literature:

*Critically compare findings with previous research, assessing consistency and discrepancies.*

The risk of POUR after lower limb joint arthroplasty has been associated with preemptive IDC in some studies

# Ethical Considerations:

## Informed Consent:

*Critically analyze the adequacy of procedures for obtaining informed consent from participants.*

Patients provided written informed consent to participate. This was modified to verbal consent in the context of COVID lockdowns that occurred during the recruitment period.

## Ethical Approval:

*Evaluate whether the study received appropriate approval from an ethics committee or institutional review board.*

HREC approval was provided by the local health district HREC committee (No: HREC/2020/QMS/67023). Approved 25-Aug-2020.

## Privacy and Confidentiality:

*Assess the adequacy of measures taken to protect participants' privacy and confidentiality.*

All interactions with patients were conducted by qualified clinical personnel within the hospital setting.

Patient information collected for the study was stored in electronic cloud infrastructure with industry-standard security and safeguards. Relevant business agreements were in place to ensure appropriate handling of patient data, with patient confidentiality enhanced by study data being stored in a deidentified format for subsequent linkage during analysis.

*Beneficence and Non-maleficence: Critically evaluate any potential risks or benefits to participants and how they were addressed.*

The possibility that patient-reported measures may detect clinically relevant changes in urinary pain and function was addressed by an electronic system created specifically for the study. The SHARKS registry, during the period of recruitment, was enhanced by electronic messaging between the data team and the clinical personnel interacting with enrolled patients. When patients submitted a web-based postoperative CLSS form, it was compared to their own baseline response and any change in the total score of \>2 points was flagged for the clinical personnel to action. This prompted the registrar to prepare a referral for urology review for the patient.

# Conflicts of Interest:

## STROBE \[22\] Funding:

*Assess the degree of transparency to which the source of funding and role of the funders have played in the study/article.*

Funding for the study planning and analysis was provided by the QEII Orthopaedic Research Fund.

## Disclosure:

*Evaluate the transparency and completeness of disclosures regarding conflicts of interest among the study authors or sponsors.*

CS declares institutional funding and consultancy for Johnson and Johnson and MatOrtho unrelated to the present work.

All other authors declare no conflicts of interest.

## Potential for Biases:

*Critically assess whether conflicts of interest could have influenced the study design, analysis, or interpretation of results.*

Study design, analysis and interpretation of the results has been conducted independently of any actual or perceived influence from listed funding sources.

# References
